replicaCount: 1

image:
  repository: ghcr.io/johannhartmann/linguagap
  tag: latest
  pullPolicy: Always

nameOverride: ""
fullnameOverride: ""

service:
  type: ClusterIP
  port: 8000

ingress:
  enabled: true
  className: traefik
  host: linguagap.data.mayflower.tech
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt
  tls:
    enabled: true
    secretName: linguagap-tls

persistence:
  enabled: true
  size: 20Gi
  storageClassName: longhorn
  accessMode: ReadWriteOnce

resources:
  requests:
    memory: "12Gi"
    cpu: "2"
    nvidia.com/gpu: "1"
  limits:
    memory: "24Gi"
    cpu: "8"
    nvidia.com/gpu: "1"

# Probes - very long initial delay for model warmup (ASR + MT 14B + diarization + language ID)
livenessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 600
  periodSeconds: 30
  timeoutSeconds: 10
  failureThreshold: 10

readinessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 600
  periodSeconds: 10
  timeoutSeconds: 10
  failureThreshold: 30

# Environment variables
env:
  ASR_MODEL: deepdml/faster-whisper-large-v3-turbo-ct2
  ASR_DEVICE: cuda
  ASR_COMPUTE_TYPE: float16
  MT_MODEL_REPO: Qwen/Qwen3-14B-GGUF
  MT_MODEL_FILE: Qwen3-14B-Q4_K_M.gguf
  MT_N_GPU_LAYERS: "-1"
  MT_N_CTX: "2048"
  WINDOW_SEC: "8.0"
  TICK_SEC: "0.5"
  STABILITY_SEC: "1.25"
  MAX_BUFFER_SEC: "30.0"
  HF_HOME: /data/hf
  HF_HUB_DISABLE_TELEMETRY: "1"
  PYTHONUNBUFFERED: "1"
  # Diarization settings
  DIARIZATION_ENABLED: "true"
  DIARIZATION_DEVICE: cuda

# Secrets configuration
# For HF_TOKEN: either create the secret manually or set create: true with value
# Manual creation: kubectl create secret generic hf-token --from-literal=token=YOUR_TOKEN -n linguagap
secrets:
  hfToken:
    enabled: true
    secretName: hf-token
    secretKey: token
    # Set create: true and value to create the secret via Helm (not recommended for production)
    create: false
    value: ""

nodeSelector: {}

tolerations: []

affinity: {}

# Monitoring configuration
monitoring:
  serviceMonitor:
    enabled: true
    interval: 30s
    scrapeTimeout: 10s
    labels:
      release: monitoring
  prometheusRule:
    enabled: true
    labels:
      release: monitoring
  grafana:
    dashboards:
      enabled: true
      label: grafana_dashboard
      folder: LinguaGap
