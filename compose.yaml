services:
  gpu-smoke:
    image: nvidia/cuda:12.8.0-runtime-ubuntu24.04
    command: nvidia-smi
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              capabilities: [gpu]
              count: 1

  backend:
    build: .
    ports:
      - "0.0.0.0:8000:8000"
    volumes:
      - hf-cache:/data/hf
    environment:
      - PYTHONUNBUFFERED=1
      - HF_HOME=/data/hf
      - HF_HUB_DISABLE_TELEMETRY=1
      - MT_MODEL_REPO=Qwen/Qwen3-14B-GGUF
      - MT_MODEL_FILE=Qwen3-14B-Q4_K_M.gguf
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              capabilities: [gpu]
              count: 1

volumes:
  hf-cache:
