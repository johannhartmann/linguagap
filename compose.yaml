services:
  gpu-smoke:
    image: nvidia/cuda:12.8.0-runtime-ubuntu24.04
    command: nvidia-smi
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              capabilities: [gpu]
              count: 1

  backend:
    build: .
    ports:
      - "0.0.0.0:8000:8000"
    volumes:
      - hf-cache:/data/hf
    environment:
      - PYTHONUNBUFFERED=1
      - HF_HOME=/data/hf
      - HF_HUB_DISABLE_TELEMETRY=1
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              capabilities: [gpu]
              count: 1

volumes:
  hf-cache:
